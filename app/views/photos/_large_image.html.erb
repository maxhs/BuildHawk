<% unless @p && !p %>
	<% @p = p %>
<% end %>
<% if @p && @p.image_file_name %>
	<div class="image-block large" id="photo-<%=@p.id%>">
		<%= link_to image_tag(@p.image.url(:large)), @p.image.url(:original), :class => "shadow-photo remote", :rel => "shadowbox[Mixed]" %> 
		
		<div class="image-details">
			<% if @p.name.length > 0 %>
				<div><span class="label">Name:</span>
					<%= form_for @p, :method => :patch, :remote => true do |f| %>
						<%= f.text_field :name, :style=>"padding:0;border:0; display:inline-block" %><span style="color:#222;font-size:13px;" id="click-to-edit" class="font-smoothing">(click name to edit)</span>
					<% end %>
				</div> 
			<% end %>
			<div><span class="label">Date:</span><%= @p.created_date %></div>
			<div><% if @p.source %><span class="label">Source:</span><%= @p.source %><% end %></div> 
			<div><% if @p.user %><span class="label">Uploaded by:</span><%= @p.user.full_name %><% else %>&nbsp;<% end %></div>
		</div>
		
		<% if current_user.admin || current_user.company_admin || @p.user == current_user %>
		<button class="btn btn-danger btn-md pull-right"><%= link_to 'Delete Photo', photo_path(@p), :method => :delete, :class=>"delete-link", :remote => true, :data => {:confirm => "Are you sure you want to delete this photo? This can't be undone."} %></button>
		<% end %>
		
	</div>
<% else %>
	<div class="no-image-placeholder">No Document</div>
<% end %>
<script>
	Shadowbox.clearCache();
	Shadowbox.setup(".shadow-photo", {});
	$("#photo_name").focus(function(){
		$('#click-to-edit').fadeOut(170,function(){
			$(this).text('(enter/return to save)');
			$(this).fadeIn(170);
		});
	});
	$("#photo_name").focusout(function(){
		$('#click-to-edit').fadeOut(170,function(){
			$(this).text('(click name to edit)');
			$(this).fadeIn(170);
		});
	});
</script>