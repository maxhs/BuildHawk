<%= nested_form_for @item, url: worklist_item_path(@item), :multipart => true, :method => :patch, :remote => true do |f| %>
	<%= hidden_field_tag :authenticity_token, form_authenticity_token %>

	<div id="worklist-item-container" class="border-box container">
		<div class="row">
			<div class="col-xs-2"><h5>Item</h5></div><div class="col-xs-10"><%= f.text_field :body, :placeholder => "Describe the worklist item" %></div>
		</div>
		<div class="row">
			<div class="col-xs-2">
				<h5>Location</h5>
			</div>
			<div class="col-xs-10">
				<%= f.text_field :location, :placeholder => "Add a location (optional)" %>
			</div>		
		</div>
		<div class="row" style="font-size:1.1em;margin-top:2.5%;margin-bottom:2.5%;">
			<div class="col-xs-2"><h5>Status</h5></div>
			<div class="col-xs-10">
				<div>
					<%= f.radio_button :completed, false %><h5 style="display:inline-block">IN PROGRESS</h5>
				</div>
				<div>
					<%= f.radio_button :completed, true %><h5 style="display:inline-block">COMPLETED</h5>
					<% if @item.completed_by_user %>
						<span style="color:#aaa;margin-left:5%;font-family:'Source Sans Pro', helvetica, sans-serif;"> by <%= @item.completed_by_user.full_name %>, <%= parse_time @item.completed_at %></span>
					<% end %>
				</div>
			</div>
		</div>

	<% if !@item.completed_by_user %>

		<%= f.fields_for :assignee do |a| %>
			<h5 style="display:inline-block;width:16.666666664%;">Assignee</h5>
			<%= a.select :full_name, (@users.map(&:full_name)+@subs.map(&:name)).unshift("No Assignment"), {:include_blank => false}, :class=>"assignee-select", :style => "text-align:center;display:inline-block;font-size:1.2em;position:relative;top:-3px;" %>
		<% end %>
	
	<% end %>
		
	<% if @item.photos && @item.photos.count > 0 %>
		<div style="padding:30px 0;padding-top:20px;">
			<% @item.photos.each do |p| %>
				<% if p.image_file_name%>
					<%= render :partial => "photos/image", :locals => {:p => p} %>
				<% end %>
			<% end %>
		</div>
	<% end %>
	
	<h5>Add a photo</h5>
	<%= f.fields_for :photos, @item.photos.build do |photo| %>
		<%= photo.file_field :image %>
		<%= photo.hidden_field :project_id, :value => @project.id %>
		<%= photo.hidden_field :user_id, :value => current_user.id %>
		<% if @item.id %><%= photo.hidden_field :worklist_item_id, :value => @item.id %><% end %>
		<%= photo.hidden_field :source, :value => "Worklist" %>
	<% end %>

	<div class="button-container">
		<%= f.submit "Save", :class => "btn btn-success btn-md save" %>
<% end %>

	<% if current_user.admin || current_user.company_admin || current_user.uber_admin || @item.user == current_user %>
		<%= link_to "Delete", worklist_item_path(@item), :method => :delete, :class=> "delete-link remote btn btn-danger btn-md", :style=>"display:block", :data => {:confirm => "Are you sure you want to delete this item?"}, remote: true %>
	<% end %>
	</div>
</div>

<div class="border-box comment-container" style="margin-top:20px;clear:both">
	<h4 style="text-align:center; width:50%;margin:20px auto; display:block;">Comments</h4>
	<div id="comments-form">
		<%= form_for @item.comments.new, :method => :post, :remote => true do |f| %>
			<%= f.text_area :body, :rows => "3", :placeholder => "Type your notes/comment here" %>
			<%= f.hidden_field :user_id, :value => current_user.id %>
			<%= f.hidden_field :worklist_item_id, :value => @item.id %>
			<%= f.submit "Send", :class => "btn btn-success btn-md pull-right", :style => "margin-top:14px;" %>
		<% end %>
	</div>
	<%= render :partial => "comments/comments", :locals => {:comments => @item.comments} %>
</div>