<li class="subcategory" id="subcategory-<%=subcategory.id%>">
	<div class="header row">
		<div class="col-xs-6">
			<h3 style="display:inline-block"><%= subcategory.name %></h3>
			<span style="padding-left:1em;color:#aaa;">(<%=subcategory.completed_count%> of <%= subcategory.checklist_items.count%>)</span>
			<%= link_to "Edit Category", subcategory_checklist_path(@project, :subcategory_id => subcategory.id, :project_id => @project.id), :style=>"margin-left:20px;", :class=>"remote", :remote => true %>
		</div>
		<div class="col-xs-2 category-label">
			<%= parse_date(subcategory.milestone_date) %>
		</div>
		<div class="col-xs-2 category-label">
			<%= parse_date(subcategory.completed_date) %>
		</div>
		<div class="col-xs-2 category-label">&nbsp;</div>
	</div>

	<div id="sub-<%=subcategory.id%>">
		<ul class="subcategory-items" id="items-<%=subcategory.id%>">
			<%= render partial:"projects/item", collection:subcategory.checklist_items, as: :item, cache: false %>
		</ul>
	<% if current_user.admin %>
		<% if subcategory.checklist_items.count > 0 %>
			<% count = subcategory.checklist_items.count %>
		<% else %>
			<% coutn = 0 %>
		<% end %> 
		<%= link_to "New Checklist Item", new_item_project_path(@project, :subcategory_id => subcategory.id, :item_index => count), :id=>"new-item-#{subcategory.id}", :class=>"remote new-checklist-item", :remote => true %>
		<%= link_to "New Category", new_subcategory_project_path(@project, :subcategory_id => subcategory.id, :order_index => count, :category_id => subcategory.category.id), :id=>"new-subcategory-#{subcategory.id}", :class=>"remote new-subcategory", :remote => true %>
	<% end %>
	</div>
</li>

<script>
	$(document).ready(function(){
		$('#items-<%=subcategory.id%>').sortable({
          axis: 'y',
          dropOnEmpty:true,
          cursor: 'move',
          items: 'li',
          opacity: 0.4,
          scroll: true,
          stop: function(){
            $.ajax({
                type: 'post',
                data: $('#items-<%=subcategory.id%>').sortable('serialize') + '&id=<%= subcategory.id %>',
                dataType: 'script',
                complete: function(request){
                    //$('#categories').effect('highlight');
                  },
                url: '/checklists/order_items'})
            }
        })
       
	});
</script>