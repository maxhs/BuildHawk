<%= nested_form_for @punchlist_item, :url => {:action => :update_worklist_item, :multipart => true }, :method => :post do |f| %>
	<table id="add-punchlist">
		</tbody>
			<tr><td><h3>Edit Work List item</h3></td></tr>
			<tr><td><%= f.text_field :body, :placeholder => "Describe the work item" %></td></tr>
			<tr><td><%= f.text_field :location, :placeholder => "Add a location (optional)" %></td></tr>
			<tr><td><h4>Select an assignee</h4>
				<%= f.fields_for :assignee do |a| %>
					<%= a.select :id, @users.all.collect {|u| [u.full_name, u.id]}, {}, :multiple => true %>
				<% end %>
			</td></tr>
			<% if @punchlist_item.photos && @punchlist_item.photos.count > 0 %>
				<tr><td style="padding:30px 0;padding-top:20px;">
					<% @punchlist_item.photos.each do |p| %>
						<% if p.image_file_name%>
							<div style="width:220px;text-align:left;display:inline-block;">
								<%= link_to p.image.url(:original), :class => "shadow-photo", :rel => "shadowbox[Mixed]" do %> 
									<%= image_tag p.image.url(:small) %> 
									<div>Date: <%= p.created_date%> </div>
									<% if p.source %><div>Source: <%= p.source%></div> <% end %>
								<% end %>
							</div>
						<% end %>
					<% end %>
				</td></tr>
			<% end %>

			<tr><td><h4>Add a photo</h4>
				<%= f.fields_for :photos, @punchlist_item.photos.build do |photo| %>
					<%= photo.file_field :image %>
					<%= photo.hidden_field :project_id, :value => @project.id %>
					<% if @punchlist_item.id %><%= photo.hidden_field :punchlist_item_id, :value => @punchlist_item.id %><% end %>
					<%= photo.hidden_field :source, :value => "Worklist" %>
				<% end %>
			</td></tr>
			<tr><td><button class="btn btn-success btn-md pull-right"><%= f.submit "Save" %></button></td></tr>
			<tr><td style="float:right;"><%= link_to "Delete Item", delete_worklist_item_projects_path(@project, :item_id => @punchlist_item.id), :method => :delete, :data => {:confirm => "Are you sure you want to delete this item?"}, :style=>"float:right;padding-top:20px;" %></td></tr>
			<%= hidden_field_tag :authenticity_token, form_authenticity_token -%>
			<%= hidden_field_tag :punchlist_item_id, @punchlist_item.id %>
		</tbody>
	</table>
<% end %>

<h3 style="text-align:center; width:50%;margin:20px auto; display:block;">Comments</h3>
<div id="comments-form">
	<%= form_for @punchlist_item.comments.new, :method => :post, :remote => true do |f| %>
		<%= f.text_area :body, :rows => "3", :placeholder => "Type your notes/comment here" %>
		<%= f.hidden_field :user_id, :value => current_user.id %>
		<%= f.hidden_field :punchlist_item_id, :value => @punchlist_item.id %>
		<button class="btn btn-success btn-md pull-right" style="margin-top:14px;"><%= f.submit "Send" %></button>
	<% end %>
</div>

<%= render :partial => "projects/comments", :locals => {:comments => @punchlist_item.comments} %>