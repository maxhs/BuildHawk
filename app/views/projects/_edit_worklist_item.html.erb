<%= nested_form_for @punchlist_item, :url => {:action => :update_worklist_item, :multipart => true }, :method => :post do |f| %>
	<div id="add-punchlist" class="border-box" style="padding-bottom:30px;">
		<div id="punchlist-container">
			<div class="row">
				<div class="col-xs-2"><h4>Item:</h4></div><div class="col-xs-10"><%= f.text_field :body, :placeholder => "Describe the worklist item" %></div>
			</div>
			<div class="row">
				<div class="col-xs-2"><h4>Location:</h4></div><div class="col-xs-10"><%= f.text_field :location, :placeholder => "Add a location (optional)" %></div>
			</div>
			<div class="row" style="font-size:1.15em;margin-top:1em;margin-bottom:1em;">
				<div class="col-xs-2"><h4>Status:</h4></div>
				<div class="col-xs-3" style="padding-top:9px;font-family:'Gotham Book'"><%= f.radio_button :completed, false %>IN PROGRESS</div><div class="col-xs-3" style="padding-top:9px;font-family:'Gotham Book'"><%= f.radio_button :completed, true %>COMPLETED</div>
				<% if @punchlist_item.completed %>
					<div class="col-md-4" style="text-align:center;">
						<h4 style="margin:0;">Completed By:</h4>
						<%= @punchlist_item.completed_by_user.full_name %>
					</div>
				<% else %>
			</div>
		
			

				<div>
					<h4>Select an assignee</h4>
					<%= f.fields_for :assignee do |a| %>
						<%= a.select :full_name, @users.map(&:full_name).unshift("No Assignment"), {:include_blank => false}, :class=>"assignee-select", :style => "text-align:center;" %>
					<% end %>
				</div>

			<% end %>
			<% if @punchlist_item.photos && @punchlist_item.photos.count > 0 %>
				<div style="padding:30px 0;padding-top:20px;">
					<% @punchlist_item.photos.each do |p| %>
						<% if p.image_file_name%>
							<%= render :partial => "image", :locals => {:p => p} %>
						<% end %>
					<% end %>
				</div>
			<% end %>

			<div><h4 style="text-align:center;">Add a photo</h4>
				<%= f.fields_for :photos, @punchlist_item.photos.build do |photo| %>
					<%= photo.file_field :image %>
					<%= photo.hidden_field :project_id, :value => @project.id %>
					<%= photo.hidden_field :user_id, :value => current_user.id %>
					<% if @punchlist_item.id %><%= photo.hidden_field :punchlist_item_id, :value => @punchlist_item.id %><% end %>
					<%= photo.hidden_field :source, :value => "Worklist" %>
				<% end %>
			</div>
			<%= hidden_field_tag :authenticity_token, form_authenticity_token -%>
			<%= hidden_field_tag :punchlist_item_id, @punchlist_item.id %>
			<div><button class="btn btn-success btn-md pull-right"><%= f.submit "Save" %></button></div>
<% end %>

		<div style="clear:both;">
			<button class="btn btn-danger btn-md pull-right"><%= link_to "Delete", punchlist_item_path(@punchlist_item), :method => :delete, :class=> "delete-link remote", :data => {:confirm => "Are you sure you want to delete this item?"}, :remote => true %></button>
		</div>
	</div>
</div>

<div class="border-box" style="margin-top:20px;clear:both">
	<h3 style="text-align:center; width:50%;margin:20px auto; display:block;">Comments</h3>
	<div id="comments-form">
		<%= form_for @punchlist_item.comments.new, :method => :post, :remote => true do |f| %>
			<%= f.text_area :body, :rows => "3", :placeholder => "Type your notes/comment here" %>
			<%= f.hidden_field :user_id, :value => current_user.id %>
			<%= f.hidden_field :punchlist_item_id, :value => @punchlist_item.id %>
			<button class="btn btn-success btn-md pull-right" style="margin-top:14px;"><%= f.submit "Send" %></button>
		<% end %>
	</div>

	<%= render :partial => "projects/comments", :locals => {:comments => @punchlist_item.comments} %>
</div>