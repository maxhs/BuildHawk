<div id="project-checklist">
	<% if @checklist %>
		<div class="project-checklist-table border-box">
			<div id="checklist-items">
				<header>
					<%= form_tag search_items_checklist_path(@checklist, :project_id => @project.id), :id => "checklist-search", :method => :post, :class=>"input-group", :style=>"width:100%;", :remote => true do %>
						<%= text_field_tag :search, nil, :placeholder=>"Search for checklist items...", :class=>"form-control search" %>
						<span class="input-group-addon cancel-search" style="cursor: pointer;" id="remove">
							<span class="glyphicon glyphicon-remove"></span>
						</span>
					<% end %>				
					<div class="checklist-header row">
						<div class="col-xs-1">
							<%= image_tag "search.png", id:"checklist-search-button" %>
						</div>
						<div class="col-xs-7">
							<h4 style="display:inline-block;">Phase</h4>					
						</div>
						<div class="col-xs-2 header-label"><h4>Target</h4></div>	
						<div class="col-xs-2 header-label"><h4>Completed</h4></div>
					</div>
				</header>
				<ul id="phases">
					<%= render :partial => 'projects/phase', collection: @checklist.phases, :as => :p, cache: true %>
				</ul>
				<% if current_user.admin %>
					<%= link_to "Add a new phase", new_phase_path(:checklist_id => @checklist.id,:project_id => @project.id), :id=>"new-phase", :class=>"remote new-phase simple-btn", remote: true %>
				<% end %>
			</div>
		</div>
	<% else %>
		<div style="text-align:center;font-style:italic"><h3 style="color:#aaa;font-weight:100;padding-top:100px;">No checklist items</h3></div>
		<div style="text-align:center;font-style:italic"><%= link_to "Remove this checklist?", delete_checklist_project_path(@project, :checklist_id => @checklist.id), :remote => true, :method => :delete %></div>	
	<% end %>
</div>

<div id="checklist-focus">
	<% if @item %>
		<%= render :partial => "checklist_item", :locals => {:item => @item} %>
	<% end %>
</div>

<script>

	$(document).on('click',".checklist-item-link",function(){
		$('.active-item').removeClass('active-item');
		$(this).parent().parent().addClass('active-item');
	});
	$(document).ready(function(){
		$('#checklist-search-button').click(function(){
			if ($('#checklist-search').css('display') == "none"){
				$('#checklist-search').fadeIn().css('display','table');
			} else {
				$('#checklist-search').fadeOut(200);
			}
		});
		$('#remove').on('click',function(){
			$('#search').val('');
			$('#checklist-search').submit();
		});

		$('#phases').sortable({
          axis: 'y',
          dropOnEmpty:true,
          cursor: 'move',
          items: 'li',
          opacity: 0.4,
          scroll: true,
          stop: function(){
            $.ajax({
                type: 'post',
                data: $('#phases').sortable('serialize') + '&id=<%=@checklist.id-%>',
                dataType: 'script',
                url: '/checklists/order_phases'})
            }
        })

        <% @checklist.phases.each do |p| %>
        	$('#<%= p.id %>-items').sortable({
	          axis: 'y',
	          dropOnEmpty:true,
	          cursor: 'move',
	          items: 'li',
	          opacity: 0.4,
	          scroll: true,
	          stop: function(){
	            $.ajax({
	                type: 'post',
	                data: $('#<%= p.id %>-items').sortable('serialize') + '&id=<%=p.id-%>',
	                dataType: 'script',
	                url: '/checklists/order_categories'})
	            }
	        });
        <% end %>
	});
</script>