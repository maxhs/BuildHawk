
<div id="item-container" class="border-box">
	<div class="checklist-item-form">

		<% if @previous %>
		<div class="previous-item">
			<h5><%= link_to "&#8592;#{truncate("#{@previous.body}", length:30)}".html_safe, checklist_item_project_path(@project, :item_id => @previous.id), remote:true %></h5>
		</div>
	<% end %>
	<% if @next %>
		<div class="next-item">
			<h5><%= link_to "#{truncate("#{@next.body}", length:30)} &#8594;".html_safe, checklist_item_project_path(@project, :item_id => @next.id), remote:true %></h5>
		</div>
	<% end %>

		<button class="btn simple-btn" id="export-checklist-item">Export</button>
		<div class="row" style="clear:both">
			<span class="col-xs-5 header-description"><h2><%= item.phase_name %></h2></span>
		</div>
		<div class="row">
			<span class="col-xs-5 header-description"><h4><%= item.category_name %></h4></span>
		</div>
		<div class="row">
			<span class="col-xs-12 item-body">- <%= item.body %></span>
		</div>

		<%= nested_form_for item, :url => {:controller => :checklist_items, :action => :update, :id => item.id, :multipart => true}, :remote => true, :method => :post do |f| %>
			<div class="row">
				<div class="col-xs-6" style="text-align:center; display:inline-block;float:left;">
					<h4>Status</h4>
					<%= f.select :state, options_for_select({"In-Progress"=>0,"Completed"=>1,"Not Applicable"=>-1,"No Status"=>nil}, selected: item.state), {:include_blank => false}, :multiple => true %>
					<span style="color:#ccc;font-weight:100;display:block;">&#8984; / Ctrl click to deselect <span>
				</div>
			
				<% if item.state == 1 && item.completed_by_user %>
					<div class="col-xs-6" style="text-align:center; width:50%;display:inline-block;text-align:center;">
						<h4>Completed By</h4>
						<%= item.completed_by_user.full_name %>
					</div>
				<% else %>
					<div class="col-xs-6" style="text-align:center;display:inline-block;text-align:center;">
						<h4 style="text-align:center;">Critical Date</h4>
						<div class="input-append date" data-date="12-02-2012" data-date-format="dd-mm-yyyy">
							<%= f.text_field :critical_date, :value => parse_date(f.object.critical_date), :placeholder => Time.now.strftime("%m/%d/%Y"), :class =>"date-input", :id => "dp" %>
							<span id="clear-critical-date"> Clear Date</span>
						</div>
					</div>
				<% end %>

				<% if item.photos && item.photos.count > 0 %>
					<div class="col-xs-12" style="padding:30px 0;padding-top:60px;clear:both;">
						<% item.photos.each do |p| %>
							<% if p.image_file_name%>
								<%= render :partial => "photos/image", :locals => {:p => p} %>
							<% end %>
						<% end %>
					</div>
				<% end %>

				<div class="col-xs-12" style="text-align:center;padding:20px;clear:both;"><h4>Add a photo</h4>
					<%= f.fields_for :photos, item.photos.build do |photo| %>
						<%= photo.file_field :image, :style=>"margin:0 auto;" %>
						<%= photo.hidden_field :user_id, :value => current_user.id %>
						<%= photo.hidden_field :project_id, :value => @project.id %>
						<% if item.phase_name %><%= photo.hidden_field :phase, :value => item.phase_name %><% end %>
						<% if item.id %><%= photo.hidden_field :checklist_item_id, :value => item.id %><% end %>
						<%= photo.hidden_field :source, :value => "Checklist" %>
					<% end %>
				</div>

				<div class="button-container">	
					<%= f.submit "Update", :class => "no-link simple-btn", :style=>"width:50%;" %>
		<% end %>
					<% if current_user.admin || current_user.company_admin %>
						<%= link_to image_tag('trashButton.png', :class=>"remote delete-img", :style=>"width:20px;"), checklist_item_path(item), :data => {:confirm => "Are you sure you want to delete this checklist item?"}, :method => :delete, :class=>"delete-link remote", :style => "clear:both;display:block;width:100px;margin:5px auto;", :remote => true %>
					<% end %>
				</div>
			</div>		
	</div>
</div>

<div class="border-box comment-container" style="margin-top:20px;overflow:auto;">
	<h3 style="text-align:center; width:80%;margin:20px auto; display:block;">Comments</h3>
	<div id="comments-form">
		<%= form_for item.comments.new, :method => :post, :remote => true do |f| %>
			<%= f.text_area :body, :rows => "3", :placeholder => "Type your notes/comment here" %>
			<%= f.hidden_field :user_id, :value => current_user.id %>
			<%= f.hidden_field :checklist_item_id, :value => item.id %>
			<%= f.submit "Post", :class=>"simple-btn pull-right", :style=>"margin-top:14px;" %>
		<% end %>
	</div>
	<%= render :partial => "comments/comments", :locals => {:comments => item.comments} %>
</div>

<% if item.activities.count > 0 %>
	<div class="border-box activity-container" style="margin-top:20px;overflow:auto;">
		<h3 style="text-align:center; width:80%;margin:20px auto; display:block;">Activity</h3>
		<%= render :partial => "activities/activity", collection: item.activities, as: :activity, cache: true %>
	</div>
<% end %>

<script type="text/javascript">
	$(document).ready(function(){
		checklistItem();
		$('#export-checklist-item').on('click',function(){
			if (!$('#export-checklist-modal').length > 0){
				$('#item-container').prepend('<%= j render partial:"checklist_item_export", locals: {:item => item} %>');
			}

			$('body').append('<div class="modal-backdrop in"></div>');
			$('#export-checklist-modal').animate({"left":"25%",'opacity':'1'},300);
			$('#cancel-checklist-modal,.modal-backdrop.in').on('click',function(){
				$('#export-checklist-modal').animate({"left":"100%",'opacity':'0'},300);
				$('.modal-backdrop.in').fadeOut(300,function(){
					$(this).remove();
				});
			});
		});
	});
</script>