<div id="connect-form">
	<ul id="connect-progress">
		<li class="active">Confirm Details</li>
		<li>Choose Password</li>
		<li>Confirm Company</li>
	</ul>
	<div id="errors"></div>
<%= form_for user, method: :post, remote:true do |f| %>
<%= devise_error_messages! %>
	<fieldset id="info">
		<h3 class="fs-title">Is Your Information Correct?</h3>
		<%= hidden_field_tag :connect %>
		<%= f.text_field :first_name, :placeholder => "First name", :autofocus => true %>
		<%= f.text_field :last_name, :placeholder => "Last name" %>
		<%= f.email_field :email, :placeholder => "The email address you use for work" %>
		<%= f.text_field :phone, :placeholder => "Your phone number" %>
			<!--<div style="width:49%;display:inline-block;text-align:center;"><a onclick>No</a> </div>-->
			<input type="button" name="no" onclick="editfields();" class="no action-button" value="No" />
			<input type="button" name="yes" class="yes action-button" value="Yes" />
	</fieldset>
	<fieldset id="password">
		<h2 class="fs-title">Choose a password</h2>
		<%= f.password_field :password, :placeholder => "Choose a password", :autocomplete => "off" %>
		<%= f.password_field :password_confirmation, :placeholder => "Click here to confirm your password", :autocomplete => "off" %>
		<input type="button" name="previous" class="previous action-button" value="Previous" />
		<input type="button" name="next" class="yes submit action-button" value="Next" />
	</fieldset>
<% end %>

	<%= form_tag search_companies_path, :id => "companies-search", :method => :post, :class=>"input-group", :style=>"width:100%;", :remote => true do %>
		<fieldset id="company">
			<h2 class="fs-title">Confirm your company</h2>
			<%= text_field_tag :search, user.company.name, :placeholder=>"Search for your company...", :style=>"border:1px solid #ddd;width:90%;float:left;",:class=>"form-control" %>
			<span class="input-group-addon" style="cursor: pointer;width:auto;border:0;" id="remove"><span class="glyphicon glyphicon-remove"></span></span>
			<div id="search-results"></div>
			<input type="button" name="previous" class="previous action-button" value="Previous" />
			<input type="button" name="next" class="yes action-button" value="Next" />
		</fieldset>
	<% end %>
</div>
<script>
	function editfields(){
		$('#register-container form input[type="text"],#register-container form input[type="email"]').css({"border-color":"#ddd","background":"#fff"},function(){$('#register-container form input[type="text"]').focus()});
	}
	$(document).ready(function(){
		$('#remove').on('click',function(){
			$('#search').val('');
			$('#companies-search').submit();
		});
	});

</script>
<script>
	//jQuery time
var current_fs, next_fs, previous_fs; //fieldsets
var left, opacity, scale; //fieldset properties which we will animate
var animating; //flag to prevent quick multi-click glitches

var info = $('#info');
var password = $('#password');
var company = $('#company');

$(".yes").click(function(){
	if(animating) return false;
	animating = true;

	if ($(this).parent().is(info)){
		current_fs = info;
		next_fs = password;
	} else if ($(this).parent().is(password)){
		var userPassword = document.getElementById('user_password');
		var userPasswordConfirmation = document.getElementById('user_password_confirmation');
		if (userPassword.value.length === 0){
			$('#errors').text("Please make sure you've entered a password before continuing.").fadeIn(200);
		} else if (userPasswordConfirmation.value.length === 0){
			$('#errors').text("Please make sure you've confirmed your password before continuing.").fadeIn(200);
		} else {
			if (userPassword.value != userPasswordConfirmation.value){
				$('#errors').text("Your passwords don't match.").fadeIn(200);
			} else {
				current_fs = password;
				next_fs = company;
			}
		}
	} else if ($(this).parent().is(company)) {
		current_fs = company;
		next_fs = nil;
	}
	
	if (current_fs && next_fs){
		//activate next step on progressbar using the index of next_fs
		$("#connect-progress li").eq($("fieldset").index(next_fs)).addClass("active");
		next_fs.show(); 
		current_fs.animate({opacity: 0}, {
			step: function(now, mx) {
				//as the opacity of current_fs reduces to 0 - stored in "now"
				//1. scale current_fs down to 80%
				scale = 1 - (1 - now) * 0.2;
				//2. bring next_fs from the right(50%)
				left = (now * 50)+"%";
				//3. increase opacity of next_fs to 1 as it moves in
				opacity = 1 - now;
				current_fs.css({'transform': 'scale('+scale+')'});
				next_fs.css({'left': left, 'opacity': opacity});
			}, 
			duration: 800, 
			complete: function(){
				current_fs.hide();
				animating = false;
			}, 
			easing: 'easeInOutBack'
		});
	}
});

$(".previous").click(function(){
	if(animating) return false;
	animating = true;
	
	if ($(this).parent().is(info)){
		return;
	} else if ($(this).parent().is(password)){
		current_fs = password;
		previous_fs = info;
	} else if ($(this).parent().is(company)){
		current_fs = company;
		previous_fs = password;
	} else {
		return;
	}

	if (current_fs && previous_fs){
		//de-activate current step on progressbar
		$("#connect-progress li").eq($("fieldset").index(current_fs)).removeClass("active");
		previous_fs.show(); 
		current_fs.animate({opacity: 0}, {
			step: function(now, mx) {
				//as the opacity of current_fs reduces to 0 - stored in "now"
				//1. scale previous_fs from 80% to 100%
				scale = 0.8 + (1 - now) * 0.2;
				//2. take current_fs to the right(50%) - from 0%
				left = ((1-now) * 50)+"%";
				//3. increase opacity of previous_fs to 1 as it moves in
				opacity = 1 - now;
				current_fs.css({'left': left});
				previous_fs.css({'transform': 'scale('+scale+')', 'opacity': opacity});
			}, 
			duration: 800, 
			complete: function(){
				current_fs.hide();
				animating = false;
			}, 
			easing: 'easeInOutBack'
		});
	}
});

$(".submit").click(function(){
	return false;
})

</script>