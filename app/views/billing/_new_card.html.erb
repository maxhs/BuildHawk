<script type="text/javascript" src="https://js.stripe.com/v2/"></script>
<script type="text/javascript">
	$(document).ready(function() {
		$('#payment-form').submit(function(event) {
		    var form = $(this);
		    form.find('button').prop('disabled', true);
		    Stripe.setPublishableKey('<%=@stripe_key%>');
		    var token = Stripe.card.createToken(form, stripeResponseHandler);
		    console.log('stripe token? '+token);
		    event.preventDefault();
		    return false;
		});
	});
</script>
<div id="billing">
	<%= form_tag charges_path do %>
  <article>
    <label class="amount">
      <span>Amount: $5.00</span>
    </label>
  </article>

  <script src="https://checkout.stripe.com/checkout.js" class="stripe-button"
          data-key="<%= Rails.configuration.stripe[:publishable_key] %>"
          data-description="A month's subscription"
          data-amount="500"></script>
<% end %>
	<div id="edit-billing-container" class="border-box">
		<div id="dismiss-card-container">
			<%= link_to image_tag("blackX.png"), billing_index_path, remote: true %>
		</div>
		<h2 style="text-align:center;">Add New Card</h2>
		<%= form_tag billing_index_path, method: :post, :id=>"payment-form", remote:true do %>
			<%= hidden_field_tag :authenticity_token, form_authenticity_token %>
		  	<span class="payment-errors"></span>

		  	<div class="form-row">
		    	<label>
		      		<span>Card Number</span>
		     		<input type="text" size="20" data-stripe="number" class="card-info" />
		    	</label>
		    	<label>
		      		<span>CVC</span>
		      		<input type="text" size="4" data-stripe="cvc"/>
		    	</label>
		 	 </div>

		  	<div class="form-row">
		    	<label>
		      		<span>Expiration (MM/YYYY)</span>
		      		<input type="text" size="2" data-stripe="exp-month" />
		    	</label>
		    	<span> / </span>
		    	<input type="text" size="4" data-stripe="exp-year" />
		  	</div>

		  	<label>Make Primary</label>
		  	<%= check_box_tag :active %>
		  	<div style="text-align:center;"><%=submit_tag "Create", :class=>"simple-btn" %></div>
		<% end %>
	</div>
</div>
<script type="text/javascript" src="https://js.stripe.com/v2/"></script>
<script type="text/javascript">
	$(document).ready(function() {
		$('#payment-form').submit(function(event) {
		    var form = $(this);
		    form.find('button').prop('disabled', true);
		    Stripe.setPublishableKey(<%=@stripe_key%>);
		    var token = Stripe.card.createToken(form, stripeResponseHandler);
		    event.preventDefault();
		    return false;
		});
	});
</script>
